<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generador de Eventos ICS</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    .font-montserrat {
      font-family: 'Montserrat', sans-serif;
    }
    .font-roboto {
      font-family: 'Roboto', sans-serif;
    }
  </style>
</head>
<body class="bg-[#FAF9F9] text-[#074983] font-montserrat relative">
  <!-- Modal para instrucciones -->
  <div id="instructions-modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden items-center justify-center p-4">
    <div class="bg-white p-6 rounded shadow max-w-md w-full space-y-4">
      <h2 class="text-[#E63946] text-3xl font-medium">Instrucciones</h2>
      <p class="text-base">1. Escribe el nombre del evento.</p>
      <p class="text-base">2. Elige cu√°ntos meses mostrar en el calendario.</p>
      <p class="text-base">3. Selecciona las fechas en el calendario.</p>
      <p class="text-base">4. Elige el tipo de evento (Horario regular o Horario No regular).</p>
      <p class="text-base">5. Asigna una hora de inicio (obligatoria) y elige entre hora de fin o duraci√≥n en minutos (al menos uno es obligatorio).</p>
      <p class="text-base">6. Opcional: A√±ade una descripci√≥n al evento.</p>
      <p class="text-base">7. Puedes generar el archivo ICS o ver el texto ICS en pantalla antes de descargarlo. Tambi√©n puedes restablecer el formulario.</p>
      <div class="text-right">
        <button id="close-instructions" class="px-4 py-2 bg-white text-[#074983] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA]">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal para mostrar el texto del ICS -->
  <div id="ics-modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden items-center justify-center p-4">
    <div class="bg-white p-6 rounded shadow max-w-md w-full space-y-4 overflow-auto max-h-[80vh]">
      <h2 class="text-[#E63946] text-3xl font-medium">Contenido ICS</h2>
      <pre id="ics-content" class="text-base whitespace-pre-wrap"></pre>
      <div class="text-right">
        <button id="close-ics" class="px-4 py-2 bg-white text-[#074983] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA]">Cerrar</button>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 mt-8 p-6 bg-white rounded shadow text-center">
    <div class="flex justify-center mb-6">
      <div class="w-32 h-auto">
        <!-- Logotipo (reemplazado con el SVG correcto del primer c√≥digo) -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 793.70135 1122.52">
          <title>NamasData</title>
          <defs>
            <clipPath id="clipPath18" clipPathUnits="userSpaceOnUse">
              <path d="M 0,841.89 H 595.276 V 0 H 0 Z" />
            </clipPath>
          </defs>
          <g transform="matrix(1.3333333,0,0,-1.3333333,0,1122.52)">
            <g clip-path="url(#clipPath18)">
              <g transform="translate(319.9385,566.8408)">
                <path style="fill:#074983;stroke:#074983;stroke-width:2"
                  d="m 0,0 c 0.072,3.622 -3.023,7.021 -6.397,7.026 -3.432,0.005 -7.964,-3.692 -7.928,-6.466 0.04,-3.06 4.43,-7.054 7.901,-7.188 C -2.545,-6.777 -0.085,-4.238 0,0 m -5.928,-59.827 c -4.768,-0.037 -8.003,-3.07 -7.887,-7.651 0.11,-4.3 2.964,-5.87 6.733,-5.518 2.833,0.264 7.096,-0.874 7.231,3.979 0.187,6.765 -1.655,9.224 -6.077,9.19" />
              </g>
              <g transform="translate(275.5149,526.8959)">
                <path style="fill:#074983;stroke:#074983;stroke-width:2"
                  d="m 0,0 c 3.817,0.113 7.234,3.366 7.263,6.915 0.029,3.366 -4.169,7.21 -7.788,7.132 C -4.09,13.971 -6.868,10.872 -6.817,7.028 -6.763,2.917 -3.823,-0.113 0,0" />
              </g>
              <g transform="translate(357.6885,533.9154)">
                <path style="fill:#074983;stroke:#074983;stroke-width:2"
                  d="m 0,0 c -0.115,3.773 -3.831,7.105 -7.773,6.968 -3.329,-0.116 -6.37,-3.661 -6.231,-7.262 0.146,-3.775 3.457,-6.999 7.144,-6.957 C -3.336,-7.21 0.109,-3.57 0,0" />
              </g>
              <text style="font-style:italic;font-weight:bold;font-size:48px;font-family:Montserrat;fill:#074983;stroke:#074983;stroke-width:1;letter-spacing:2px" transform="matrix(1,0,0,-1,147.3042,266.0947)">NamasData</text>
            </g>
          </g>
        </svg>
      </div>
    </div>

    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-medium text-[#E63946]">üóìÔ∏è Generador de Eventos ICS</h1>
      <button id="open-instructions" class="px-3 py-1 bg-white text-[#074983] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA]">Instrucciones</button>
    </div>
    
    <div class="space-y-4 text-left">
      <div>
        <label for="event-name" class="block mb-1 text-[#074983] font-normal text-base">üìå Nombre del evento:</label>
        <input type="text" id="event-name" class="w-full p-2 border rounded" placeholder="Ej. Reuni√≥n de equipo" />
      </div>

      <div>
        <label for="event-description" class="block mb-1 text-base text-[#074983]">üìù Descripci√≥n (opcional):</label>
        <textarea id="event-description" class="w-full p-2 border rounded" placeholder="Ej. Revisi√≥n del proyecto y siguientes pasos..."></textarea>
      </div>

      <div class="my-4 border-t border-gray-300"></div>

      <div>
        <p class="mb-1 text-[#074983] text-base">üóìÔ∏è Meses a mostrar (1 a 12):</p>
        <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2">
          <input type="number" id="months-input" min="1" max="12" value="1" class="w-full sm:w-20 p-2 border rounded" />
          <button type="button" id="update-calendar" class="px-3 py-1 bg-[#E63946] text-[#FAF9F9] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA] hover:text-[#074983]">Actualizar</button>
        </div>
      </div>

      <div class="my-4 border-t border-gray-300"></div>

      <div>
        <p class="mb-1 text-base text-[#074983]">üìÖ Selecciona las fechas:</p>
        <div id="calendar" class="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
      </div>

      <div id="selected-dates-summary" class="mt-4 text-[#074983] text-center">
        <p class="text-base">Fechas seleccionadas: <span id="selected-dates-count">0</span></p>
      </div>

      <div class="my-4 border-t border-gray-300"></div>

      <div>
        <p class="mb-1 text-2xl font-normal text-[#18A4E6]">üéØ Tipo de evento:</p>
        <div class="flex space-x-4">
          <label class="inline-flex items-center space-x-2 text-base text-[#074983]">
            <input type="radio" name="event-type" value="regular" class="form-radio" checked />
            <span>Horario regular</span>
          </label>
          <label class="inline-flex items-center space-x-2 text-base text-[#074983]">
            <input type="radio" name="event-type" value="non-regular" class="form-radio" />
            <span>Horario No regular</span>
          </label>
        </div>
      </div>

      <div class="my-4 border-t border-gray-300"></div>

      <div id="regular-times" class="space-y-2">
        <p class="text-base text-[#074983]">‚è∞ Horario (para eventos regulares):</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <div>
            <label for="start-time" class="block mb-1 text-base text-[#074983]">Hora de inicio (obligatoria):</label>
            <input type="time" id="start-time" class="w-full p-2 border rounded"/>
          </div>
          <div>
            <label for="end-time" class="block mb-1 text-base text-[#074983]">Hora fin (opcional):</label>
            <input type="time" id="end-time" class="w-full p-2 border rounded"/>
          </div>
          <div>
            <label for="duration" class="block mb-1 text-base text-[#074983]">Duraci√≥n (min, opcional):</label>
            <input type="number" id="duration" class="w-full p-2 border rounded" placeholder="Ej. 30"/>
          </div>
        </div>
      </div>

      <div id="non-regular-times" class="hidden">
        <p class="mb-1 text-base text-[#074983]">‚è≥ Horarios por fecha (para eventos no regulares):</p>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse text-sm text-[#074983]">
            <thead>
              <tr class="text-left">
                <th class="border-b p-2">Fecha</th>
                <th class="border-b p-2">Hora inicio (obligatoria)</th>
                <th class="border-b p-2">Hora fin (opcional)</th>
                <th class="border-b p-2">Duraci√≥n (min, opcional)</th>
              </tr>
            </thead>
            <tbody id="dates-table-body"></tbody>
          </table>
        </div>
      </div>

      <div class="my-4 border-t border-gray-300"></div>

      <div class="text-center pt-4 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 justify-center">
        <button type="button" id="generate-ics" class="px-4 py-2 bg-[#E63946] text-[#FAF9F9] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA] hover:text-[#074983]">Generar Archivo ICS</button>
        <button type="button" id="view-ics" class="px-4 py-2 bg-white text-[#074983] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA]">Ver texto ICS</button>
        <button type="button" id="reset-form" class="px-4 py-2 bg-white text-[#074983] border-2 border-[#074983] rounded font-roboto hover:bg-[#EBF2FA]">Borrar formulario</button>
      </div>
    </div>

    <div id="placeholder" class="mt-6 text-[#074983] italic hidden text-center text-base">
      Selecciona fechas para comenzar a generar tu evento.
    </div>

    <div class="mt-8 text-center text-sm text-[#074983]">
      Alex Ayala - <a href="https://www.namasdata.com" target="_blank" class="text-[#18A4E6] hover:underline">www.namasdata.com</a>
    </div>
  </div>

  <script>
    const calendar = document.getElementById('calendar')
    const placeholder = document.getElementById('placeholder')
    const monthsInput = document.getElementById('months-input')
    const updateCalendarBtn = document.getElementById('update-calendar')
    const eventTypeInputs = document.getElementsByName('event-type')
    const regularTimesDiv = document.getElementById('regular-times')
    const nonRegularTimesDiv = document.getElementById('non-regular-times')
    const datesTableBody = document.getElementById('dates-table-body')
    const resetFormBtn = document.getElementById('reset-form')
    const selectedDatesCount = document.getElementById('selected-dates-count')
    const generateIcsBtn = document.getElementById('generate-ics')
    const viewIcsBtn = document.getElementById('view-ics')

    const startTimeInput = document.getElementById('start-time')
    const endTimeInput = document.getElementById('end-time')
    const durationInput = document.getElementById('duration')

    const eventNameInput = document.getElementById('event-name')
    const eventDescriptionInput = document.getElementById('event-description')

    const instructionsModal = document.getElementById('instructions-modal')
    const openInstructionsBtn = document.getElementById('open-instructions')
    const closeInstructionsBtn = document.getElementById('close-instructions')

    const icsModal = document.getElementById('ics-modal')
    const icsContentPre = document.getElementById('ics-content')
    const closeIcsBtn = document.getElementById('close-ics')

    let currentICSContent = ''
    const selectedDates = new Set()
    const dayInitials = ['L','M','X','J','V','S','D']

    function formatMonthName(date) {
      const monthName = date.toLocaleString('es-ES', { month: 'long', year: 'numeric' })
      return monthName.charAt(0).toUpperCase() + monthName.slice(1)
    }

    function formatDateEsp(isoDate) {
      const parts = isoDate.split('-') 
      return `${parts[2]}/${parts[1]}/${parts[0]}`
    }

    // Construir la fecha ISO de forma manual
    function buildIsoDate(year, month, day) {
      const yyyy = year
      const mm = String(month + 1).padStart(2,'0')
      const dd = String(day).padStart(2,'0')
      return `${yyyy}-${mm}-${dd}`
    }

    function generateMonth(today, i) {
      const month = new Date(today.getFullYear(), today.getMonth() + i, 1)
      const monthName = formatMonthName(month)
      const monthDays = new Date(month.getFullYear(), month.getMonth() + 1, 0).getDate()
      const firstDayIndex = (month.getDay() + 6) % 7

      const monthContainer = document.createElement('div')
      monthContainer.classList.add('mb-6')

      const monthTitle = document.createElement('h3')
      monthTitle.textContent = monthName
      monthTitle.classList.add('text-center','text-sm','mb-2','col-span-7','text-[#074983]')
      monthContainer.appendChild(monthTitle)

      const monthGrid = document.createElement('div')
      monthGrid.classList.add('grid','grid-cols-7','gap-2','text-center')

      dayInitials.forEach(d => {
        const dayHeader = document.createElement('div')
        dayHeader.textContent = d
        dayHeader.classList.add('font-bold','text-[#074983]')
        monthGrid.appendChild(dayHeader)
      })

      for (let emptyCell = 0; emptyCell < firstDayIndex; emptyCell++) {
        const emptyDiv = document.createElement('div')
        emptyDiv.classList.add('p-2','border','rounded','text-sm','flex','flex-col','items-center','justify-center','opacity-50')
        monthGrid.appendChild(emptyDiv)
      }

      for (let day = 1; day <= monthDays; day++) {
        const date = new Date(month.getFullYear(), month.getMonth(), day)
        // Generar isoDate manualmente
        const isoDate = buildIsoDate(month.getFullYear(), month.getMonth(), day)
        const dayOfWeek = (date.getDay() + 6) % 7

        const dayDiv = document.createElement('button')
        dayDiv.type = 'button'
        dayDiv.textContent = day
        dayDiv.classList.add('p-2','border','rounded','text-sm','flex','flex-col','items-center','justify-center','hover:bg-[#EBF2FA]')
        dayDiv.dataset.date = isoDate

        if (dayOfWeek === 5 || dayOfWeek === 6) {
          dayDiv.classList.add('bg-red-100')
        }

        if (selectedDates.has(isoDate)) {
          dayDiv.classList.add('bg-blue-300','text-white')
        }

        dayDiv.addEventListener('click', event => {
          event.preventDefault()
          toggleDate(isoDate, dayDiv)
        })

        monthGrid.appendChild(dayDiv)
      }

      monthContainer.appendChild(monthGrid)
      return monthContainer
    }

    function generateCalendar(monthsAhead = 1) {
      calendar.innerHTML = ''
      const today = new Date()

      for (let i = 0; i < monthsAhead; i++) {
        const monthContainer = generateMonth(today, i)
        calendar.appendChild(monthContainer)
      }
    }

    function toggleDate(date, button) {
      if (selectedDates.has(date)) {
        selectedDates.delete(date)
        button.classList.remove('bg-blue-300','text-white')
      } else {
        selectedDates.add(date)
        button.classList.add('bg-blue-300','text-white')
      }

      placeholder.classList.toggle('hidden', selectedDates.size > 0)
      updateSelectedDatesCount()
      updateNonRegularTable()
    }

    function updateSelectedDatesCount() {
      selectedDatesCount.textContent = selectedDates.size
    }

    function getEventType() {
      for (const input of eventTypeInputs) {
        if (input.checked) return input.value
      }
      return 'regular'
    }

    function updateNonRegularTable() {
      datesTableBody.innerHTML = ''
      if (getEventType() === 'non-regular') {
        selectedDates.forEach(isoDate => {
          const row = document.createElement('tr')

          const dateCell = document.createElement('td')
          dateCell.classList.add('border-b','p-2')
          dateCell.textContent = formatDateEsp(isoDate)

          const startCell = document.createElement('td')
          startCell.classList.add('border-b','p-2')
          const startInput = document.createElement('input')
          startInput.type = 'time'
          startInput.classList.add('p-1','border','rounded','w-full')
          startInput.dataset.date = isoDate + '-start'
          startCell.appendChild(startInput)

          const endCell = document.createElement('td')
          endCell.classList.add('border-b','p-2')
          const endInput = document.createElement('input')
          endInput.type = 'time'
          endInput.classList.add('p-1','border','rounded','w-full')
          endInput.dataset.date = isoDate + '-end'
          endCell.appendChild(endInput)

          const durationCell = document.createElement('td')
          durationCell.classList.add('border-b','p-2')
          const durationInput = document.createElement('input')
          durationInput.type = 'number'
          durationInput.classList.add('p-1','border','rounded','w-full')
          durationInput.placeholder = 'Ej. 30'
          durationInput.dataset.date = isoDate + '-duration'
          durationCell.appendChild(durationInput)

          row.appendChild(dateCell)
          row.appendChild(startCell)
          row.appendChild(endCell)
          row.appendChild(durationCell)
          datesTableBody.appendChild(row)
        })
      }
    }

    function handleEventTypeChange() {
      const type = getEventType()
      if (type === 'regular') {
        regularTimesDiv.classList.remove('hidden')
        nonRegularTimesDiv.classList.add('hidden')
      } else {
        regularTimesDiv.classList.add('hidden')
        nonRegularTimesDiv.classList.remove('hidden')
        updateNonRegularTable()
      }
    }

    function validateTimeRangeOrDuration(start, end, duration) {
      if (!start) return false
      if (!end && (!duration || isNaN(duration) || duration <= 0)) return false
      if (duration && duration > 0) return true
      const [startH, startM] = start.split(':').map(Number)
      const [endH, endM] = end.split(':').map(Number)
      const startDate = new Date(2020, 0, 1, startH, startM)
      const endDate = new Date(2020, 0, 1, endH, endM)
      return endDate > startDate
    }

    function computeEndTimeFromDuration(start, duration) {
      const [startH, startM] = start.split(':').map(Number)
      const startDate = new Date(2020, 0, 1, startH, startM)
      const endDate = new Date(startDate.getTime() + duration * 60000)
      const endH = String(endDate.getHours()).padStart(2,'0')
      const endMin = String(endDate.getMinutes()).padStart(2,'0')
      return `${endH}:${endMin}`
    }

    function formatDateTime(dateStr, timeStr) {
      const dt = dateStr.replace(/-/g,'')
      const tm = timeStr.replace(':','')
      return `${dt}T${tm}00`
    }

    function generateICSContent(eventName, eventType, description) {
      const lines = ['BEGIN:VCALENDAR','VERSION:2.0','CALSCALE:GREGORIAN']
      const descLine = description ? `DESCRIPTION:${description.replace(/\n/g, '\\n')}` : ''

      if (eventName && selectedDates.size > 0) {
        if (eventType === 'regular') {
          const start = startTimeInput.value
          const end = endTimeInput.value
          const dur = parseInt(durationInput.value,10)

          if (start && (end || (dur && dur>0)) && validateTimeRangeOrDuration(start, end, dur)) {
            selectedDates.forEach(isoDate => {
              lines.push('BEGIN:VEVENT')
              lines.push(`SUMMARY:${eventName}`)
              if (descLine) lines.push(descLine)
              const startDT = formatDateTime(isoDate,start)
              let endDT = ''
              if (dur && dur > 0) {
                const computedEnd = computeEndTimeFromDuration(start, dur)
                endDT = formatDateTime(isoDate, computedEnd)
              } else {
                endDT = formatDateTime(isoDate,end)
              }
              lines.push(`DTSTART:${startDT}`)
              lines.push(`DTEND:${endDT}`)
              lines.push('END:VEVENT')
            })
          }
        } else {
          const rows = datesTableBody.querySelectorAll('tr')
          rows.forEach(row => {
            const displayDate = row.querySelector('td').textContent
            const [d,m,y] = displayDate.split('/')
            const isoDate = `${y}-${m}-${d}`

            const startInput = row.querySelector('td:nth-child(2) input')
            const endInput = row.querySelector('td:nth-child(3) input')
            const durationInput = row.querySelector('td:nth-child(4) input')

            const start = startInput.value
            const end = endInput.value
            const dur = parseInt(durationInput.value,10)

            if (start && (end || (dur && dur>0)) && validateTimeRangeOrDuration(start, end, dur)) {
              lines.push('BEGIN:VEVENT')
              lines.push(`SUMMARY:${eventName}`)
              if (descLine) lines.push(descLine)
              const startDT = formatDateTime(isoDate,start)
              let endDT = ''
              if (dur && dur > 0) {
                const computedEnd = computeEndTimeFromDuration(start, dur)
                endDT = formatDateTime(isoDate, computedEnd)
              } else {
                endDT = formatDateTime(isoDate,end)
              }
              lines.push(`DTSTART:${startDT}`)
              lines.push(`DTEND:${endDT}`)
              lines.push('END:VEVENT')
            }
          })
        }
      }

      lines.push('END:VCALENDAR')
      return lines.join('\n')
    }

    function generateICS() {
      const eventName = eventNameInput.value.trim()
      const eventDescription = eventDescriptionInput.value.trim()
      const eventType = getEventType()

      if (!eventName || !selectedDates.size) {
        alert('Por favor, completa el nombre del evento y selecciona al menos una fecha.')
        return
      }

      if (eventType === 'regular') {
        const start = startTimeInput.value
        const end = endTimeInput.value
        const dur = parseInt(durationInput.value,10)

        if (!start) {
          alert('La hora de inicio es obligatoria.')
          return
        }

        if (!end && (!dur || isNaN(dur) || dur <= 0)) {
          alert('Debes proporcionar hora de fin o duraci√≥n, al menos una de ellas.')
          return
        }

        if (!validateTimeRangeOrDuration(start, end, dur)) {
          alert('La hora de fin o la duraci√≥n no es v√°lida (debe ser posterior a la hora de inicio).')
          return
        }

      } else {
        const rows = datesTableBody.querySelectorAll('tr')
        for (const row of rows) {
          const displayDate = row.querySelector('td').textContent
          const startInput = row.querySelector('td:nth-child(2) input')
          const endInput = row.querySelector('td:nth-child(3) input')
          const durationInput = row.querySelector('td:nth-child(4) input')

          const start = startInput.value
          const end = endInput.value
          const dur = parseInt(durationInput.value,10)

          if (!start) {
            alert(`La hora de inicio es obligatoria para la fecha: ${displayDate}`)
            return
          }

          if (!end && (!dur || isNaN(dur) || dur <= 0)) {
            alert(`Debes proporcionar hora de fin o duraci√≥n en minutos para la fecha: ${displayDate}`)
            return
          }

          if (!validateTimeRangeOrDuration(start, end, dur)) {
            alert(`La hora de fin o la duraci√≥n no es v√°lida para la fecha: ${displayDate}`)
            return
          }
        }
      }

      currentICSContent = generateICSContent(eventName, eventType, eventDescription)
      downloadICS(currentICSContent, eventName)
    }

    function viewICS() {
      const eventName = eventNameInput.value.trim()
      const eventDescription = eventDescriptionInput.value.trim()
      const eventType = getEventType()

      const icsPreview = generateICSContent(eventName, eventType, eventDescription)
      icsContentPre.textContent = icsPreview
      icsModal.classList.remove('hidden')
      icsModal.classList.add('flex')
    }

    function downloadICS(icsContent, eventName) {
      const blob = new Blob([icsContent], { type: 'text/calendar' })
      const url = URL.createObjectURL(blob)
      const link = document.createElement('a')
      link.href = url
      link.download = `${eventName}.ics`
      link.click()
    }

    function resetForm() {
      eventNameInput.value = ''
      eventDescriptionInput.value = ''
      startTimeInput.value = ''
      endTimeInput.value = ''
      durationInput.value = ''
      selectedDates.clear()
      document.querySelector('input[name="event-type"][value="regular"]').checked = true
      handleEventTypeChange()

      const monthsValue = parseInt(monthsInput.value, 10)
      generateCalendar(isNaN(monthsValue) || monthsValue < 1 || monthsValue > 12 ? 1 : monthsValue)
      updateSelectedDatesCount()
      placeholder.classList.toggle('hidden', selectedDates.size > 0)
      currentICSContent = ''
    }

    eventTypeInputs.forEach(input => {
      input.addEventListener('change', handleEventTypeChange)
    })

    updateCalendarBtn.addEventListener('click', () => {
      const monthsValue = parseInt(monthsInput.value, 10)
      if (isNaN(monthsValue) || monthsValue < 1 || monthsValue > 12) {
        alert('Por favor, introduce un valor entre 1 y 12.')
        return
      }
      generateCalendar(monthsValue)
    })

    resetFormBtn.addEventListener('click', resetForm)
    generateIcsBtn.addEventListener('click', generateICS)
    viewIcsBtn.addEventListener('click', viewICS)

    openInstructionsBtn.addEventListener('click', () => {
      instructionsModal.classList.remove('hidden')
      instructionsModal.classList.add('flex')
    })
    closeInstructionsBtn.addEventListener('click', () => {
      instructionsModal.classList.add('hidden')
      instructionsModal.classList.remove('flex')
    })

    closeIcsBtn.addEventListener('click', () => {
      icsModal.classList.add('hidden')
      icsModal.classList.remove('flex')
    })

    generateCalendar(1)
    updateSelectedDatesCount()
    handleEventTypeChange()
  </script>
</body>
</html>
